<!DOCTYPE html>
<html lang="en">

<head>
  <title>service-turtle</title>
</head>

<body>
  <h1>service-turtle</h1>

  <div>
    <button id="fetch">Fetch something</button>
  </div>

  <script>

    function fetch(url) {
      var request = new XMLHttpRequest();
      request.open('GET', url, true);

      request.onload = function() {
        if (request.status >= 200 && request.status < 400){
          console.log('response from', url, request.status, request.responseText);
        } else {
          // We reached our target server, but it returned an error
          console.error('some error', url, request.responseText);
        }
      };

      request.onerror = function() {
        // There was a connection error of some sort
        console.error('error', url, request.responseText);
      };

      request.send();
    }

    function onButtonClick() {
      console.log('button clicked');
      fetch('/some/url');
    }

    document.addEventListener('DOMContentLoaded', function() {
      document.querySelector('#fetch').addEventListener('click', onButtonClick);
    });

    if (navigator && navigator.serviceWorker) {
      navigator.serviceWorker.register('/service-turtle.js').then(function (reg) {
        console.log('Caught service turtle, use `turtle` object to mock responses');


        window.turtle = {
          get: function (url, code) {
            if (navigator.serviceWorker && navigator.serviceWorker.controller) {
              navigator.serviceWorker.controller.postMessage({
                method: 'get',
                url: url,
                code: code
              });
            }
          }
        };

      }, function(err) {
        console.error('no luck loading service worker', err);
      });
    } else {
      console.error('Sorry, not ServiceWorker feature, maybe enable it?');
      console.error('http://jakearchibald.com/2014/using-serviceworker-today/');
    }
  </script>
</body>
</html>
